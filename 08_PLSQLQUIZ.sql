--1
--student, subject, enrol 테이블 생성
--2
SELECT * FROM STUDENT;
INSERT INTO STUDENT VALUES(20101059,'조병준','컴퓨터정보',1,'B','M',164,70);
--3
INSERT INTO STUDENT VALUES(20102038,'남지선','전기전자',1,'C','F','',70);
--4 ?
INSERT INTO STUDENT VALUES(20103009, '박소신', '기계','','B','M','')
SELECT STU_GRADE
FROM STUDENT
WHERE STU_NO=20132003;

SELECT * FROM STUDENT;
DELETE FROM

--5
CREATE TABLE COPY_STUDENT
AS SELECT * FROM STUDENT
WHERE STU_GRADE=3;

SELECT * FROM COPY_STUDENT;

--6
UPDATE STUDENT SET STU_CLASS='B' WHERE STU_NO=20153088;

--7
SET SERVEROUTPUT ON;
DECLARE
    vstudent STUDENT%ROWTYPE;
BEGIN
    SELECT * INTO vsungjuk
    FROM STUDENT
    STUDENT.STU_CLASS = vstudent.stu_class + 1;
END;

--7
UPDATE STUDENT SET STU_GRADE = STU_GRADE + 1 WHERE STU_GRADE IS NOT NULL;

--8
UPDATE ENROL SET ENR_GRADE = ENR_GRADE - 10 WHERE SUB_NO = (SELECT SUB_NO FROM SUBJECT WHERE SUB_NAME='기계공작법');
                                                
--9
UPDATE ENROL SET ENR_GRADE = 0 WHERE SUB_NO = (SELECT SUB_NO FROM SUBJECT WHERE SUB_NAME='소프트웨어공학');
SELECT * FROM ENROL;
--10
DELETE FROM STUDENT WHERE STU_NO = 20131001;

SELECT * FROM STUDENT;
--11
INSERT INTO SUBJECT VALUES(112,'자동화시스템','고종민',3,'기계');
--12
CREATE TABLE COPY_SUBJECT
AS SELECT * FROM SUBJECT;

CREATE TABLE COPY_ENROL
AS SELECT * FROM ENROL;

SELECT *
FROM COPY_SUBJECT SUB, COPY_ENROL E
WHERE E.SUB_NO(+) = SUB.SUB_NO;

SELECT * FROM COPY_SUBJECT;


UPDATE COPY_SUBJECT SET SUB_NO = 999 WHERE SUB_NO NOT IN (SELECT SUB_NO FROM COPY_ENROL);

SELECT * FROM COPY_SUBJECT;

--13
DELETE FROM COPY_SUBJECT WHERE SUB_NO = 999;

--14
CREATE TABLE dept(
    DEPTNO NUMBER(2),
    DNAME VARCHAR2(14),
    LOC VARCHAR2(13),
    CONSTRAINT PK_DEPT PRIMARY KEY(DEPTNO)
);

--15
INSERT INTO DEPT VALUES(10,'ACCOUNTING','NEW YORK');
INSERT INTO DEPT VALUES(20,'RESEARCH','DALLAS');
INSERT INTO DEPT VALUES(30,'SALES','CHICAGO');
INSERT INTO DEPT VALUES(40,'OPERATIONS','BOSTON');
SELECT * FROM DEPT;

--16
CREATE TABLE emp (
    EMPNO NUMBER(4),
    ENAME VARCHAR2(10),
    JOB VARCHAR2(9),
    MGR NUMBER(4),
    HIREDATE DATE,
    SAL NUMBER(7),
    COMM NUMBER(7),
    DEPTNO NUMBER,
    CONSTRAINT PK_EMP PRIMARY KEY(EMPNO),
    CONSTRAINT FK_DEPTNO FOREIGN KEY(DEPTNO) REFERENCES dept(DEPTNO)
);
--17
INSERT INTO EMP VALUES(7839,'KING','PRESIDENT','','81/11/17',5000,'',10);
INSERT INTO EMP VALUES(7654,'MARTIN','SALESMAN',7654,'81/09/28',1250,1400,30);
INSERT INTO EMP VALUES(7698,'BLAKE','MANAGER',2850,'81/05/01',2850,'',30);
INSERT INTO EMP VALUES(7782,'CLARK','MANAGER',7839,'81/06/09',2450,'',10);
INSERT INTO EMP VALUES(7788,'SCOTT','ANALYST',7566,'87/07/13',3000,'',20);
INSERT INTO EMP VALUES(7902,'FORD','ANALYST',7566,'81/12/03',3000,'',20);
INSERT INTO EMP VALUES(7499,'ALLEN','SALESMAN',7689,'81/02/20',1600,300,30);
INSERT INTO EMP VALUES(7521,'WARD','SALESMAN',7689,'81/02/22',1250,500,30);
INSERT INTO EMP VALUES(7844,'TRUNER','SALESMAN',7654,'81/09/08',1500,0,30);
INSERT INTO EMP VALUES(7900,'TRUNER','SALESMAN',7654,'81/12/03',950,1400,30);
SELECT * FROM EMP;

--18
CREATE TABLE salgrade (
    GRADE NUMBER(7,2),
    LOSAL NUMBER(7,2),
    HISAL NUMBER(7,2)
       
);
--19
INSERT INTO SALGRADE VALUES(1, 700, 1200);
INSERT INTO SALGRADE VALUES(2, 1201, 1400);
INSERT INTO SALGRADE VALUES(3, 1401, 2000);
INSERT INTO SALGRADE VALUES(4, 2001, 3000);
--20
CREATE TABLE COPY_EMP
AS SELECT * FROM EMP;

--21
DESC COPY_EMP;
--22
INSERT INTO COPY_EMP
SELECT * FROM EMP WHERE DEPTNO = 20;

--23
INSERT INTO COPY_EMP
SELECT *
FROM EMP
WHERE DEPTNO=30 AND COMM IS NOT NULL;

--24
ALTER TABLE COPY_EMP ADD GENDER CHAR(1);

SELECT * FROM COPY_EMP;

--25
ALTER TABLE COPY_EMP MODIFY GENDER VARCHAR2(10);

--변경 명령어로는 ALTER을 씁니다. 
--
--
--
--형태는 다음과 같습니다.
--
--
--
--ALTER TABLE (테이블 명) MODIFY (컬럼명 데이터타입);
--
--
--
--예시) ALTER TABLE HUMANS MODIFY (HUMANS_ID VARCHAR2(10));
--
--
--
--
--
--데이터 타입 변경어와 더불어 컬럼추가, 컬럼변경, 컬럼삭제 에도 ALTER 명령어가 쓰입니다.
--
--
--
---컬럼추가 
--
--형태 : ALTER TABLE 테이블명 ADD (컬럼명 데이터타입);
--
--예시 : ALTER TABLE HUMANS ADD (NAME VARCHAR2(20));
--
--
--
---컬럼변경
--
--형태 : ALTER TABLE 테이블명 RENAME COLUMN 원래컬럼명 TO 바꿀컬럼명;
--
--예시 : ALTER TABLE HUMANS RENAME COLUMN PHONE_NUMBER TO PHONE;
--
--
--
---컬럼삭제
--
--형태 : ALTER TABLE 테이블명 DROP COLUMN 컬럼명;
--
--예시 : ALTER TABLE HUMANS DROP COLUMN CAR;
--
--
--
--출처: https://tisthory.tistory.com/46 [호리의 저장고]
--26 ?
ALTER TABLE COPY_EMP DROP COLUMN GENDER;

--27 ?
TRUNCATE TABLE COPY_EMP;

--28
ALTER TABLE EMP DISABLE CONSTRAINT FK_DEPTNO CASCADE;
--ALTER TABLE ENROL DISABLE CONSTRAINT FK_SUB_NO CASCADE;
--CONSTRAINT FK_DEPTNO FOREIGN KEY(DEPTNO) REFERENCES dept(DEPTNO)

--29
ALTER TABLE EMP ENABLE CONSTRAINT FK_DEPTNO;

--30
ALTER TABLE EMP DROP CONSTRAINT FK_DEPTNO CASCADE;
--31
ALTER TABLE EMP ADD CONSTRAINT FK_DEPTNO
FOREIGN KEY(DEPTNO) REFERENCES DEPT(DEPTNO);
--32
INSERT INTO COPY_EMP
SELECT *
FROM EMP
WHERE DEPTNO IN (20,30);

--33
CREATE TABLE COPY_DEPT
AS SELECT * FROM DEPT;
--34
CREATE TABLE COPY_SALGRADE
AS SELECT * FROM SALGRADE;
DROP TABLE COPY_SALGRADE;

SELECT * FROM EMP;

--35
INSERT INTO EMP VALUES(7703,'JOSH','SALESMAN',7566,SYSDATE,1400,0,20);
--36
INSERT INTO EMP VALUES(7410,'HOMER','','',SYSDATE,1300,'',10);
--37
INSERT INTO EMP VALUES(7323,'BRANDA','','',SYSDATE,1600,'',30);
SELECT * FROM EMP;

--38
UPDATE EMP SET JOB = 'ANALYST' WHERE EMPNO = 7654;

--39
UPDATE EMP SET SAL = 0.9*SAL WHERE DEPTNO = 20;

--40
UPDATE EMP SET SAL = SAL + 100;

--41
SELECT * FROM EMP;

UPDATE EMP SET MGR = 7654, DEPTNO = 30 WHERE EMPNO = 7902;

SELECT * FROM DEPT;
--42
UPDATE EMP SET SAL = SAL - 10 WHERE DEPTNO = (SELECT DEPTNO FROM DEPT WHERE LOC='DALLAS');

--43 ?
SELECT * FROM EMP;
SELECT * FROM SALGRADE;

UPDATE EMP 
SET SAL = SAL - 20
WHERE SAL IN (SELECT SAL --WHERE 조건절은 파라미터가 들어가야 되고 비교연산자 또는 기호(IN, ANY, ALL, SOME)등이 들어가야 한다.
FROM EMP E, SALGRADE S
WHERE SAL BETWEEN LOSAL AND HISAL
AND GRADE = 2);


SELECT SAL, A.LOSAL, A.HISAL
FROM EMP, (SELECT LOSAL, HISAL FROM SALGRADE WHERE GRADE = 2) A
WHERE SAL BETWEEN A.LOSAL AND A.HISAL;

--44
DELETE FROM EMP WHERE EMPNO=7499;

--45
SELECT * FROM DEPT;
INSERT INTO DEPT VALUES(50,'PLANNING','MIAMI');

--46
UPDATE DEPT SET DEPTNO = 60 WHERE DEPTNO = 40;

--47 ?
ALTER TABLE EMP DISABLE CONSTRAINT FK_DEPTNO CASCADE;
DELETE FROM DEPT WHERE DEPTNO = 30;
ALTER TABLE EMP ENABLE CONSTRAINT FK_DEPTNO;

--48
UPDATE EMP SET SAL = SAL + 100 WHERE MGR IS NULL;

--49
UPDATE EMP SET DEPTNO = 99 WHERE ENAME='SCOTT' OR ENAME='WARD';

--50
UPDATE EMP SET COMM = 0
WHERE COMM IS NULL;

--51
TRUNCATE TABLE COPY_EMP;
TRUNCATE TABLE COPY_DEPT;
TRUNCATE TABLE COPY_SALGRADE;

--52
DROP TABLE COPY_EMP;
DROP TABLE COPY_DEPT;
DROP TABLE COPY_SALGRADE;

--53
CREATE VIEW V_EMP
AS SELECT * FROM EMP
WHERE DEPTNO = 20;

--54
SELECT * FROM V_EMP;

--55 ? 왜 조인을 안해도되지?
CREATE VIEW V_EMP_DEPT
AS SELECT EMPNO, ENAME, DNAME, EMP.DEPTNO
FROM EMP, DEPT
WHERE EMP.DEPTNO = DEPT.DEPTNO;

SELECT * FROM EMP;

DROP VIEW V_EMP_DEPT;

--56 ?
SELECT * FROM V_EMP_DEPT
ORDER BY EMPNO;

--57 ?
SELECT EMPNO, ENAME, HIREDATE
FROM (SELECT * FROM EMP ORDER BY HIREDATE DESC)
WHERE ROWNUM <=5;

--58
SELECT EMPNO, ENAME, A.SAL+A.COMM
FROM (SELECT * FROM EMP E ORDER BY SAL+COMM DESC) A
WHERE ROWNUM <=7;

SELECT * FROM DEPT;

--59
SELECT DNAME 
FROM EMP, DEPT 
WHERE EMP.DEPTNO = DEPT.DEPTNO 
GROUP BY DNAME 
ORDER BY AVG(SAL) DESC;

--60

SELECT STDDEV(SAL), JOB FROM EMP, DEPT WHERE EMP.DEPTNO = DEPT.DEPTNO GROUP BY JOB ORDER BY STDDEV(SAL) DESC